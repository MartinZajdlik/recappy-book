<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecAPPy BOOK</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div class="container">

    <header class="header">
        <h1 class="title" id="homeTitle" style="cursor: pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 280 64">
              <!-- Kniha vlevo -->
              <g transform="scale(0.9)">
                <path d="M6 10 L30 22 L30 54 L6 46 Z" fill="#3aa8f0" stroke="#1e1e2f" stroke-width="1.5"/>
                <path d="M58 10 L34 22 L34 54 L58 46 Z" fill="#8ae832" stroke="#417d00" stroke-width="1.5"/>
                <line x1="10" y1="27" x2="26" y2="35" stroke="#445577" stroke-width="1"/>
                <line x1="10" y1="31" x2="26" y2="39" stroke="#445577" stroke-width="1"/>
                <line x1="10" y1="35" x2="26" y2="43" stroke="#445577" stroke-width="1"/>
                <line x1="10" y1="39" x2="26" y2="47" stroke="#445577" stroke-width="1"/>
                <line x1="38" y1="35" x2="54" y2="27" stroke="#417d00" stroke-width="1"/>
                <line x1="38" y1="39" x2="54" y2="31" stroke="#417d00" stroke-width="1"/>
                <line x1="38" y1="43" x2="54" y2="35" stroke="#417d00" stroke-width="1"/>
                <line x1="38" y1="47" x2="54" y2="39" stroke="#417d00" stroke-width="1"/>
              </g>
          
              <!-- Text vpravo -->
              <text x="75" y="40" font-family="'Segoe UI', sans-serif" font-size="24" fill="#3aa8f0" font-weight="bold">RecAPPy</text>
              <text x="190" y="40" font-family="'Segoe UI', sans-serif" font-size="24" fill="#8ae832" font-weight="bold">BOOK</text>
            </svg>
          </h1>
          


        <div class="user-info">
            <span id="usernameDisplay" class="username hidden"></span>
            <button id="logoutBtn" class="logout-btn hidden" title="Odhl√°sit se">Odhl√°sit</button>
            <button id="adminBtn" title="Admin p≈ôihl√°≈°en√≠" aria-label="Admin p≈ôihl√°≈°en√≠" style="background: none; border: none; cursor: pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#7cc7ff" viewBox="0 0 24 24">
                    <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 1.2c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
                </svg>
            </button>
        </div>




    </header>

    <main>
        <section id="publicRecipes" class="hidden">
            <h2 id="categoriesTitle">Kategorie:</h2>
            <div id="categoriesList"></div>
            <ul id="publicRecipeList" class="recipe-list"></ul>
        </section>

        <section id="authSection">
            <div class="auth-tabs">
                <button id="loginTab" class="active">P≈ôihl√°sit</button>
                <button id="registerTab">Registrovat</button>
            </div>

            <!-- P≈ôihl√°≈°en√≠ -->
            <form id="loginForm" class="auth-form">
                <input type="text" id="loginUsername" placeholder="U≈æivatelsk√© jm√©no" required>
                <input type="password" id="loginPassword" placeholder="Heslo" required>
                <button type="submit">P≈ôihl√°sit</button>
            </form>

            <!-- Registrace -->
            <form id="registerForm" class="auth-form hidden">
                <input type="text" id="registerUsername" placeholder="U≈æivatelsk√© jm√©no" required>
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Heslo" required>
                <button type="submit">Registrovat</button>
            </form>

            <div id="authError" class="error"></div>
        </section>


        <section id="adminPanel" class="hidden">
            <form id="recipeForm">
                <input type="text" id="title" placeholder="N√°zev receptu" required/>

                <select id="category" required>
                    <option value="" disabled selected>Vyberte kategorii</option>
                    <option value="Pol√©vky">Pol√©vky</option>
                    <option value="Hlavn√≠ j√≠dla">Hlavn√≠ j√≠dla</option>
                    <option value="Dezerty">Dezerty</option>
                    <option value="Sn√≠danƒõ">Sn√≠danƒõ</option>
                    <option value="Svaƒçiny">Svaƒçiny</option>
                </select>

                <textarea id="ingredients" placeholder="Ingredience" required></textarea>
                <textarea id="instructions" placeholder="Postup" required></textarea>
                <!-- Skryt√Ω input -->
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                <!-- Vlastn√≠ tlaƒç√≠tko -->
                <label for="imageInput" class="file-upload-label">üì∑ Vybrat obr√°zek</label>
                <span id="fileNameDisplay" class="file-name-display">≈Ω√°dn√Ω obr√°zek nevybr√°n</span>

                <button type="submit">P≈ôidat recept</button>
            </form>

            <ul id="recipeList" class="recipe-list"></ul>

            <section id="adminUsersSection" class="hidden" style="margin-top: 2rem;">
                <h2>Spr√°va u≈æivatel≈Ø</h2>
                <table id="usersTable" border="1" cellpadding="5" cellspacing="0" style="width: 100%; border-collapse: collapse;">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>U≈æivatelsk√© jm√©no</th>
                      <th>Email</th>
                      <th>Role</th>
                      <th>Akce</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- U≈æivatelsk√© ≈ô√°dky se dopln√≠ dynamicky -->
                  </tbody>
                </table>
              </section>
              

        </section>
    </main>

    <footer class="footer">
        &copy; <strong>RecAPPy Book</strong> ‚Äî Martin ≈Ωajdl√≠k ¬© 2025
    </footer>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const adminBtn = document.getElementById("adminBtn");
        const loginSection = document.getElementById("authSection");
        const adminPanel = document.getElementById("adminPanel");
        const loginForm = document.getElementById("loginForm");
        const authError = document.getElementById("authError");
        const recipeList = document.getElementById("recipeList");
        const recipeForm = document.getElementById("recipeForm");
        const loginTab = document.getElementById("loginTab");
        const registerTab = document.getElementById("registerTab");
        const loginFormEl = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const usernameDisplay = document.getElementById("usernameDisplay");
        const logoutBtn = document.getElementById("logoutBtn");

        const imageInput = document.getElementById("imageInput");
        const fileNameDisplay = document.getElementById("fileNameDisplay");

        imageInput.addEventListener("change", () => {
            fileNameDisplay.textContent = imageInput.files.length > 0
                ? `Vybran√Ω obr√°zek: ${imageInput.files[0].name}`
                : "≈Ω√°dn√Ω obr√°zek nevybr√°n";
        });




    
        let jwtToken = localStorage.getItem("jwtToken") || null;
        let editingId = null;
        let currentUsername = localStorage.getItem("currentUsername") || null;
        let userRole = localStorage.getItem("userRole") || null;


        if (jwtToken && currentUsername) {
            usernameDisplay.textContent = currentUsername;
            usernameDisplay.classList.remove("hidden");
            logoutBtn.classList.remove("hidden");
            loginSection.classList.add("hidden");
            adminPanel.classList.remove("hidden");
            loadRecipes();
        } else {
            recipeList.innerHTML = "";
        }
    
        adminBtn.addEventListener("click", () => {
            if (!loginSection.classList.contains("hidden")) {
                loginSection.classList.add("hidden");
                adminPanel.classList.add("hidden");
                authError.textContent = "";
            } else {
                loginSection.classList.remove("hidden");
                adminPanel.classList.add("hidden");
                authError.textContent = "";
            }
        });
    
        loginTab.addEventListener("click", () => {
            loginTab.classList.add("active");
            registerTab.classList.remove("active");
            loginFormEl.classList.remove("hidden");
            registerForm.classList.add("hidden");
            authError.textContent = "";
        });
    
        registerTab.addEventListener("click", () => {
            registerTab.classList.add("active");
            loginTab.classList.remove("active");
            registerForm.classList.remove("hidden");
            loginFormEl.classList.add("hidden");
            authError.textContent = "";
        });
    
        loginForm.addEventListener("submit", e => {
            e.preventDefault();
            const username = document.getElementById("loginUsername").value;
            const password = document.getElementById("loginPassword").value;
    
            fetch("http://localhost:8080/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({username, password}),
            })
            .then(res => {
                if (!res.ok) throw new Error("Neplatn√© p≈ôihla≈°ovac√≠ √∫daje");
                return res.json();
            })
            .then(data => {
                jwtToken = data.token;
                userRole = data.role;
                currentUsername = username;
                if (!jwtToken) throw new Error("Chybƒõj√≠c√≠ token v odpovƒõdi");
                    authError.textContent = "";
                    loginSection.classList.add("hidden");

                    usernameDisplay.textContent = username;
                    usernameDisplay.classList.remove("hidden");
                    logoutBtn.classList.remove("hidden");

                localStorage.setItem("jwtToken", jwtToken);    
                localStorage.setItem("currentUsername", currentUsername);
                localStorage.setItem("userRole", userRole);


            if (data.role === "ROLE_ADMIN") {
                adminPanel.classList.remove("hidden");
                loadRecipes();
                loadUsers();
            } else {
                document.getElementById("publicRecipes").classList.remove("hidden");
                loadPublicRecipes(); 
            }
        })

            .catch(err => {
                authError.textContent = err.message || "Chyba p≈ôi p≈ôihl√°≈°en√≠";
            });
        });
    
        // === KROK 3: Registrace u≈æivatele ===
        registerForm.addEventListener("submit", e => {
            e.preventDefault();
            const username = document.getElementById("registerUsername").value;
            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;

            fetch("http://localhost:8080/auth/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, email, password }),
            })
            .then(res => {
                if (!res.ok) throw new Error("Chyba p≈ôi registraci u≈æivatele");
                return res.text();
            })
            .then(() => {
                authError.textContent = "Registrace probƒõhla √∫spƒõ≈°nƒõ, pros√≠m p≈ôihlaste se.";

                // P≈ôepni na login tab a formul√°≈ô
                registerTab.classList.remove("active");
                loginTab.classList.add("active");
                registerForm.classList.add("hidden");
                loginFormEl.classList.remove("hidden");

                registerForm.reset();
            })
            .catch(err => {
                authError.textContent = err.message || "Chyba p≈ôi registraci.";
            });
        });


    
        function loadRecipes() {
            fetch("http://localhost:8080/recepty", {
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                    } else {
                        throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ recept≈Ø.");
                    }
                }
                return res.json();
            })
            .then(data => {
                recipeList.innerHTML = "";
                data.forEach(recipe => {
                    const li = document.createElement("li");
                    li.innerHTML = `
                        <div class="recipe-content">
                            <div class="recipe-left">
                                <strong>${recipe.title}</strong><br>
                                <em class="category">${recipe.category}</em><br>
                                <em>${recipe.ingredients.split(',').map(i => '‚Ä¢ ' + i.trim()).join('<br>')}</em><br>
                            </div>
                            <div class="recipe-right">
                                ${recipe.imagePath ? `<img class="recipe-image" src="http://localhost:8080/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                            </div>
                        </div>
                        <p class="recipe-instructions">${recipe.instructions}</p>
                        <div class="recipe-buttons">
                            <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è Upravit</button>
                            <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è Smazat</button>
                        </div>
                    `;


                    recipeList.appendChild(li);
                });
            })
            .catch(err => {
                authError.textContent = err.message;
                if (err.message.includes("odhl√°≈°en")) {
                    logoutBtn.click();
                }
            });
        }

    
        recipeForm.addEventListener("submit", e => {
            e.preventDefault();

            const recipe = {
                title: document.getElementById("title").value,
                category: document.getElementById("category").value,
                ingredients: document.getElementById("ingredients").value,
                instructions: document.getElementById("instructions").value,
            };

            const imageFile = document.getElementById("imageInput").files[0];
            const url = editingId ? `http://localhost:8080/recepty/${editingId}` : "http://localhost:8080/recepty";
            const method = editingId ? "PUT" : "POST";

            fetch(url, {
                method: method,
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + jwtToken
                },
                body: JSON.stringify(recipe)
            })
            .then(res => {
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                    }
                    throw new Error("Chyba p≈ôi ukl√°d√°n√≠ receptu.");
                }
                return res.json();
            })
            .then(data => {
                // === TADY: pokud m√°me obr√°zek a je to nov√Ω recept (ne editace), nahrajeme ho
                if (imageFile && !editingId) {
                    const formData = new FormData();
                    formData.append("image", imageFile);

                    return fetch(`http://localhost:8080/recepty/${data.id}/image`, {
                        method: "POST",
                        headers: {
                            "Authorization": "Bearer " + jwtToken
                        },
                        body: formData
                    });
                }
            })
            .then(() => {
                recipeForm.reset();
                editingId = null;
                loadRecipes();
                console.log("Recept a p≈ô√≠padnƒõ i obr√°zek ulo≈æen.");

                usernameDisplay.classList.remove("hidden");
                logoutBtn.classList.remove("hidden");
                usernameDisplay.textContent = currentUsername;

                adminPanel.classList.remove("hidden");
                loginSection.classList.add("hidden");
                document.getElementById("publicRecipes").classList.add("hidden");
            })
            .catch(err => {
                console.error("Chyba p≈ôi ukl√°d√°n√≠ receptu nebo obr√°zku:", err);
                if (err.message.includes("401") || err.message.includes("403")) {
                    authError.textContent = "Byl jsi odhl√°≈°en. P≈ôihlas se znovu.";
                    jwtToken = null;
                    usernameDisplay.textContent = "";
                    usernameDisplay.classList.add("hidden");
                    logoutBtn.classList.add("hidden");
                    loginSection.classList.remove("hidden");
                    adminPanel.classList.add("hidden");
                    document.getElementById("publicRecipes").classList.add("hidden");
                } else {
                    authError.textContent = err.message || "Chyba p≈ôi ukl√°d√°n√≠ receptu.";
                }
            });
        });


    
        const categories = ["Pol√©vky", "Hlavn√≠ j√≠dla", "Dezerty", "Sn√≠danƒõ", "Svaƒçiny"];
        const categoriesList = document.getElementById("categoriesList");
        const publicRecipeList = document.getElementById("publicRecipeList");
    
        function renderCategories() {
            categoriesList.innerHTML = "";
            categories.forEach(category => {
                const btn = document.createElement("button");
                btn.textContent = category;
                btn.addEventListener("click", () => loadPublicRecipes(category));
                categoriesList.appendChild(btn);
            });
        }
    
        function loadPublicRecipes(category) {
            let url = "http://localhost:8080/recepty";
            if (category) {
                url += "?category=" + encodeURIComponent(category);
            }
    
            adminPanel.classList.add("hidden");
            document.getElementById("publicRecipes").classList.remove("hidden");
    
            if (!category) {
                publicRecipeList.innerHTML = ""; 
                return; 
            }

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    publicRecipeList.innerHTML = "";
                    if (data.length === 0) {
                        publicRecipeList.innerHTML = "<li>≈Ω√°dn√© recepty v t√©to kategorii.</li>";
                        return;
                    }
                    data.forEach(recipe => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                            <div class="recipe-content">
                                <div class="recipe-left">
                                    <strong>${recipe.title}</strong><br>
                                    <em class="category">${recipe.category}</em><br>
                                    <em>${recipe.ingredients.split(',').map(i => '‚Ä¢ ' + i.trim()).join('<br>')}</em><br>
                                </div>
                                <div class="recipe-right">
                                    ${recipe.imagePath ? `<img class="recipe-image" src="http://localhost:8080/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                                </div>
                            </div>
                            <p class="recipe-instructions">${recipe.instructions}</p>
                            <div class="recipe-buttons">
                                ${userRole === "ROLE_ADMIN" ? `
                                    <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è Upravit</button>
                                    <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è Smazat</button>
                                ` : ""}
                            </div>

                        `;

                        publicRecipeList.appendChild(li);
                    });

                })
                .catch(() => {
                    publicRecipeList.innerHTML = "<li>Chyba p≈ôi naƒç√≠t√°n√≠ recept≈Ø.</li>";
                });
        }
    
        renderCategories();
    
        window.editRecipe = function(id) {
            fetch(`http://localhost:8080/recepty/${id}`, {
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => res.json())
            .then(recipe => {
                document.getElementById("title").value = recipe.title;
                document.getElementById("category").value = recipe.category;
                document.getElementById("ingredients").value = recipe.ingredients;
                document.getElementById("instructions").value = recipe.instructions;
                editingId = id;
            })
            .catch(() => {
                authError.textContent = "Chyba p≈ôi naƒç√≠t√°n√≠ receptu.";
            });
        };
    
        window.deleteRecipe = function(id) {
            if (!confirm("Opravdu chcete recept smazat?")) return;
            fetch(`http://localhost:8080/recepty/${id}`, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                    } else {
                        throw new Error("Chyba p≈ôi maz√°n√≠ receptu.");
                    }
                }
                loadRecipes();
            })
            .catch(err => {
                authError.textContent = err.message;
                if (err.message.includes("odhl√°≈°en")) {
                    logoutBtn.click();
                }
            });
        };


        logoutBtn.addEventListener("click", () => {
            jwtToken = null;
            editingId = null;
            currentUsername = null; 

            
            localStorage.removeItem("jwtToken");       
            localStorage.removeItem("currentUsername"); 
            localStorage.removeItem("userRole");



            usernameDisplay.textContent = "";
            usernameDisplay.classList.add("hidden");
            logoutBtn.classList.add("hidden");

            loginSection.classList.remove("hidden");
            adminPanel.classList.add("hidden");
            document.getElementById("publicRecipes").classList.add("hidden");

            authError.textContent = "";
        });

        document.getElementById("homeTitle").addEventListener("click", () => {
            // Odhl√°sit u≈æivatele
            jwtToken = null;
            editingId = null;
            currentUsername = null;

            localStorage.removeItem("jwtToken");
            localStorage.removeItem("currentUsername");

            usernameDisplay.textContent = "";
            usernameDisplay.classList.add("hidden");
            logoutBtn.classList.add("hidden");

            // Skr√Ωt sekce a zobrazit p≈ôihl√°≈°en√≠
            loginSection.classList.remove("hidden");
            adminPanel.classList.add("hidden");
            document.getElementById("publicRecipes").classList.add("hidden");

            // P≈ôepnout zpƒõt na login z√°lo≈æku
            loginTab.classList.add("active");
            registerTab.classList.remove("active");
            loginFormEl.classList.remove("hidden");
            registerForm.classList.add("hidden");

            // Smazat chybov√© hl√°≈°en√≠
            authError.textContent = "";
        });
        const adminUsersSection = document.getElementById("adminUsersSection");
        const usersTableBody = document.querySelector("#usersTable tbody");

        // Naƒçten√≠ u≈æivatel≈Ø z backendu
        function loadUsers() {
            fetch("http://localhost:8080/admin/users", {
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                    } else {
                        throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø.");
                    }
                }
                return res.json();
            })
            .then(users => {
                console.log("U≈æivatel√© z backendu:", users);
                adminUsersSection.classList.remove("hidden");  // ODHAL sekci!
                usersTableBody.innerHTML = "";

                if (users.length === 0) {
                    usersTableBody.innerHTML = `<tr><td colspan="5">≈Ω√°dn√≠ u≈æivatel√© k zobrazen√≠.</td></tr>`;
                    return;
                }

                users.forEach(user => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>
                        <select data-user-id="${user.id}" class="role-select">
                            <option value="ROLE_USER" ${user.role === "ROLE_USER" ? "selected" : ""}>USER</option>
                            <option value="ROLE_ADMIN" ${user.role === "ROLE_ADMIN" ? "selected" : ""}>ADMIN</option>
                        </select>
                        </td>
                        <td>
                        <button class="delete-user-btn" data-user-id="${user.id}">üóëÔ∏è Smazat</button>
                        </td>
                    `;
                    usersTableBody.appendChild(tr);
                });

            


                // P≈ôid√°me event listener pro zmƒõnu role
                usersTableBody.querySelectorAll(".role-select").forEach(select => {
                    select.addEventListener("change", e => {
                        const id = e.target.getAttribute("data-user-id");
                        const newRole = e.target.value;
                        changeUserRole(id, newRole);
                    });
                });

                // P≈ôid√°me event listener pro maz√°n√≠ u≈æivatele
                usersTableBody.querySelectorAll(".delete-user-btn").forEach(btn => {
                    btn.addEventListener("click", e => {
                        const id = e.target.getAttribute("data-user-id");
                        if (confirm("Opravdu chcete smazat tohoto u≈æivatele?")) {
                            deleteUser(id);
                        }
                    });
                });
            })
            .catch(err => {
                alert(err.message);
                if (err.message.includes("odhl√°≈°en")) logoutBtn.click();
            });
        }

        function changeUserRole(id, role) {
            fetch(`http://localhost:8080/admin/users/${id}/role?role=${role}`, {
                method: "PUT",
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) throw new Error("Chyba p≈ôi zmƒõnƒõ role u≈æivatele.");
                alert("Role u≈æivatele byla zmƒõnƒõna.");
                loadUsers();
            })
            .catch(err => {
                alert(err.message);
                loadUsers(); // obnov√≠me seznam kv≈Øli konzistenci
            });
        }

        function deleteUser(id) {
            fetch(`http://localhost:8080/admin/users/${id}`, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                console.log("Stav maz√°n√≠ u≈æivatele:", res.status);

                if (res.status === 401 || res.status === 403) {
                    throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                }

                if (!res.ok) {
                return res.text().then(text => {
                    console.warn("Chyba p≈ôi maz√°n√≠ u≈æivatele:", text);
                    throw new Error("Chyba p≈ôi maz√°n√≠ u≈æivatele: " + text);
                });
            }


                alert("U≈æivatel byl smaz√°n.");
                loadUsers();
            })
            .catch(err => {
                console.log("Chyba p≈ôi maz√°n√≠:", err);
                alert(err.message);

                if (err.message.includes("odhl√°≈°en")) {
                    console.warn("Vyvol√°v√°m logout kv≈Øli chybƒõ:", err.message);
                    logoutBtn.click();
                }
            });

        }

     
    });
    </script>
    <!-- Modal pro zobrazen√≠ obr√°zku p≈ôes celou obrazovku -->
    <div id="imageModal" class="image-modal hidden">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="modalImage" />
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const modal = document.getElementById("imageModal");
          const modalImg = document.getElementById("modalImage");
          const closeModal = document.querySelector(".close-modal");
      
          document.querySelectorAll(".recipe-image").forEach(img => {
            img.addEventListener("click", () => {
              modal.classList.remove("hidden");
              modalImg.src = img.src;
            });
          });
      
          closeModal.addEventListener("click", () => {
            modal.classList.add("hidden");
          });
      
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              modal.classList.add("hidden");
            }
          });
        });
      </script>
      <script>
        document.addEventListener("click", function (e) {
          const modal = document.getElementById("imageModal");
          const modalImg = document.getElementById("modalImage");
          const closeModal = document.querySelector(".close-modal");
      
          if (e.target.classList.contains("recipe-image")) {
            modal.classList.remove("hidden");
            modalImg.src = e.target.src;
          }
      
          if (e.target.classList.contains("close-modal") || e.target.id === "imageModal") {
            modal.classList.add("hidden");
          }
        });
      </script>
        
    

</body>
</html>
