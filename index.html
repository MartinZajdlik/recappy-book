<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecAPPy BOOK</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div class="container">
    <header class="header">
        <div class="header-left">
            <h1 class="title" id="homeTitle" style="cursor: pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="220" height="64" viewBox="0 0 280 64" role="img" aria-label="RecAPPy BOOK logo">
                    <!-- Kniha -->
                    <g transform="scale(0.9)">
                    <path d="M6 10 L30 22 L30 54 L6 46 Z" fill="#f4f1e6" stroke="#f4f1e6" stroke-width="2"/>
                    <path d="M58 10 L34 22 L34 54 L58 46 Z" fill="none" stroke="#f4f1e6" stroke-width="2"/>
                    <line x1="10" y1="27" x2="26" y2="35" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="10" y1="31" x2="26" y2="39" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="10" y1="35" x2="26" y2="43" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="10" y1="39" x2="26" y2="47" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="38" y1="35" x2="54" y2="27" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="38" y1="39" x2="54" y2="31" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="38" y1="43" x2="54" y2="35" stroke="#f4f1e6" stroke-width="1.5"/>
                    <line x1="38" y1="47" x2="54" y2="39" stroke="#f4f1e6" stroke-width="1.5"/>
                    </g>
                
                    <!-- Text -->
                    <text x="75" y="34" font-family="'Segoe UI', sans-serif" font-size="26" fill="#f4f1e6" font-weight="bold">RecAPPy</text>
                    <text x="75" y="54" font-family="'Georgia', serif" font-size="18" fill="#f4f1e6" font-weight="bold" letter-spacing="4">BOOK</text>
                </svg>
            </h1>
        </div>


        <div class="header-right">
            <span id="usernameDisplay" class="username hidden"></span>
            <button id="logoutBtn" class="logout-btn hidden" title="Odhl√°sit se">Odhl√°sit</button>
            <button id="adminBtn" title="Admin p≈ôihl√°≈°en√≠" aria-label="Admin p≈ôihl√°≈°en√≠">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 64 64" fill="none">
                    <!-- Hlava -->
                    <circle cx="32" cy="28" r="10" fill="#fddbb0" stroke="#000" stroke-width="1"/>
                    <!-- Kn√≠r -->
                    <path d="M24 30c2-1 4-1 6 0s4-1 6 0" stroke="#000" stroke-width="1.5" fill="none"/>
                    <!-- √ösmƒõv -->
                    <path d="M26 33c2 2 8 2 10 0" stroke="#000" stroke-width="1" fill="none"/>
                    <!-- Oƒçi -->
                    <circle cx="28" cy="26" r="1.2" fill="#000"/>
                    <circle cx="36" cy="26" r="1.2" fill="#000"/>
                    
                    <!-- ƒåepice -->
                    <path d="M20 20c-1-5 3-9 8-9 2-4 12-4 14 0 5 0 9 5 7 9-7 2-18 3-29 0z" fill="#fff" stroke="#000" stroke-width="1"/>
                    <rect x="23" y="20" width="18" height="4" rx="2" fill="#fff" stroke="#000" stroke-width="1"/>
                    
                    <!-- Tƒõlo (uniforma) -->
                    <path d="M22 38h20v16h-20z" fill="#fff" stroke="#000" stroke-width="1"/>
                    <circle cx="32" cy="42" r="1" fill="#000"/>
                    <circle cx="32" cy="46" r="1" fill="#000"/>
                    <circle cx="32" cy="50" r="1" fill="#000"/>
                    
                    <!-- Va≈ôeƒçka -->
                    <rect x="45" y="28" width="2" height="18" rx="1" fill="#c99c6a"/>
                    <circle cx="46" cy="26" r="3" fill="#c99c6a"/>
                  </svg>
                  
            </button>
        </div>
        




    </header>

    <div class="quote">
        <p>‚ÄûNƒõkte≈ô√≠ lid√© jed√≠, aby ≈æili. My ≈æijeme, abychom jedli.‚Äú</p>
    </div>

    <main>
        <section id="publicRecipes" class="hidden">
            <div id="categoriesList"></div>
            <section id="dailyTip" class="daily-tip hidden">
                <h2>TIP na dne≈°n√≠ den</h2>
                <div id="tipContent">Naƒç√≠t√°m tip...</div>
            </section>
            <ul id="publicRecipeList" class="recipe-list"></ul>
        </section>

        <section id="authSection">
            <div class="auth-tabs">
                <button id="loginTab" class="active">P≈ôihl√°sit</button>
                <button id="registerTab">Registrovat</button>
            </div>

            <!-- P≈ôihl√°≈°en√≠ -->
            <form id="loginForm" class="auth-form">
                <input type="text" id="loginUsername" placeholder="U≈æivatelsk√© jm√©no" required>
                <input type="password" id="loginPassword" placeholder="Heslo" required>
                <button type="submit">P≈ôihl√°sit</button>
            </form>

            <!-- Registrace -->
            <form id="registerForm" class="auth-form hidden">
                <input type="text" id="registerUsername" placeholder="U≈æivatelsk√© jm√©no" required>
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Heslo" required>
                <button type="submit">Registrovat</button>
            </form>


            <a id="forgotLink" href="#" style="display:block;margin-top:.5rem;">Zapomnƒõli jste heslo?</a>
            <div id="forgotSection" class="hidden" style="margin-top:.5rem;">
                <input id="forgotEmail" type="email" placeholder="E-mail" required>
                <button id="forgotSubmit">Poslat odkaz pro reset</button>
                <div id="forgotMsg" class="info"></div>
            </div>



            <div id="authError" class="error"></div>
        </section>


        <section id="adminPanel" class="hidden">

            <div id="adminTabs" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                <button id="adminRecipesTab" class="admin-tab active">üìã Recepty</button>
                <button id="adminUsersTab" class="admin-tab">üë§ U≈æivatel√©</button>
            </div>
            

            <section id="adminRecipesSection" style="margin-top: 2rem;">
                <div id="adminCategoriesList"></div>
                <ul id="adminRecipeList" class="recipe-list"></ul>
            </section>

            <form id="recipeForm" class="admin-recipe-form">

                <input type="text" id="title" placeholder="N√°zev receptu" required/>
        
                <select id="category" required>
                    <option value="" disabled selected>Vyberte kategorii</option>
                    <option value="Pol√©vky">Pol√©vky</option>
                    <option value="Hlavn√≠ j√≠dla">Hlavn√≠ j√≠dla</option>
                    <option value="Dezerty">Dezerty</option>
                    <option value="Sn√≠danƒõ">Sn√≠danƒõ</option>
                    <option value="Svaƒçiny">Svaƒçiny</option>
                </select>
        
                <textarea id="ingredients" placeholder="Ingredience" required></textarea>
                <textarea id="instructions" placeholder="Postup" required></textarea>
        
                <!-- Skryt√Ω input -->
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                <!-- Vlastn√≠ tlaƒç√≠tko -->
                <label for="imageInput" class="file-upload-label">üì∑ Vybrat obr√°zek</label>
                <span id="fileNameDisplay" class="file-name-display">≈Ω√°dn√Ω obr√°zek nevybr√°n</span>
        
                <button type="submit">P≈ôidat recept</button>
            </form>
        
            <ul id="recipeList" class="recipe-list"></ul>

        
            <section id="adminUsersSection" class="hidden" style="margin-top: 2rem;">
                <h2>Spr√°va u≈æivatel≈Ø</h2>
                <table id="usersTable" border="1" cellpadding="5" cellspacing="0" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>U≈æivatelsk√© jm√©no</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- U≈æivatelsk√© ≈ô√°dky se dopln√≠ dynamicky -->
                    </tbody>
                </table>
            </section>
        </section>
        
    </main>

    <!-- Men≈°√≠ modal pro obr√°zek -->
    <div id="imageModal" class="image-popup hidden">
        <div class="popup-content">
            <span class="close-popup">&times;</span>
            <img id="popupImage" alt="Zvƒõt≈°en√Ω obr√°zek" />
        </div>
    </div>



    <footer class="footer">
        <div class="contact">
            Kontakt: <a>recappybook@gmail.com</a>
        </div>
        &copy; <strong>RecAPPy Book</strong> ‚Äî Martin ≈Ωajdl√≠k ¬© 2025
    </footer>

</div>

<script>

    // === GLOB√ÅLN√ç PROMƒöNN√â ===
        let jwtToken = localStorage.getItem("jwtToken") || null;
        let editingId = null;
        let currentUsername = localStorage.getItem("currentUsername") || null;
        let userRole = localStorage.getItem("userRole") || null;

        let usersTableBody;

        const categories = ["Pol√©vky", "Hlavn√≠ j√≠dla", "Dezerty", "Sn√≠danƒõ", "Svaƒçiny"];
        const categoriesList = document.getElementById("categoriesList");
        const publicRecipeList = document.getElementById("publicRecipeList");

        // URL backendu na Renderu ===
        const API_BASE = "https://recappy-book.onrender.com";


    // === FUNKCE ===
    function loadPublicRecipes(category) {

        adminPanel.classList.add("hidden");
        adminRecipesSection.classList.add("hidden");
        adminUsersSection.classList.add("hidden");
        recipeForm.classList.add("hidden");

        const tipSection = document.getElementById("dailyTip");
        if (category) {
            tipSection.classList.add("hidden");
        }

        let url = `${API_BASE}/recepty`;
        if (category) {
            url += "?category=" + encodeURIComponent(category);
        }

        if (userRole !== "ROLE_ADMIN") {
            adminPanel.classList.add("hidden");
        }

        document.getElementById("publicRecipes").classList.remove("hidden");

        if (!category) {
            publicRecipeList.innerHTML = "";
            return;
        }

        fetch(url)
            .then(res => res.json())
            .then(data => {
                publicRecipeList.innerHTML = "";
                if (data.length === 0) {
                    publicRecipeList.innerHTML = "<li>≈Ω√°dn√© recepty v t√©to kategorii.</li>";
                    return;
                }
                data.forEach(recipe => {
                    const li = document.createElement("li");
                    li.innerHTML = `
                        <div class="recipe-content">
                            <div class="recipe-left">
                                <strong>${recipe.title}</strong><br>
                                <em class="category">${recipe.category}</em><br>
                                <div class="recipe-ingredients">
                                    ${recipe.ingredients.split(',').map(i => '‚Ä¢ ' + i.trim()).join('<br>')}
                                </div>
                            </div>
                            <div class="recipe-right">
                                ${recipe.imagePath ? `<img class="recipe-image" src="${API_BASE}/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                            </div>
                        </div>
                        <p class="recipe-instructions">${recipe.instructions}</p>
                        <div class="recipe-buttons">
                            ${userRole === "ROLE_ADMIN" ? `
                                <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è Upravit</button>
                                <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è Smazat</button>
                            ` : ""}
                        </div>
                    `;

                    publicRecipeList.appendChild(li);
                });

            })
            .catch(() => {
                publicRecipeList.innerHTML = "<li>Chyba p≈ôi naƒç√≠t√°n√≠ recept≈Ø.</li>";
            });
    }

    function loadDailyTip() {
    const tipSection = document.getElementById("dailyTip");
    const tipDiv = document.getElementById("tipContent");

    if (!jwtToken) {
        tipDiv.innerHTML = "P≈ôihlas se pro dne≈°n√≠ tip!";
        tipSection.classList.remove("hidden");
        return;
    }

    fetch(`${API_BASE}/recepty/random`, {
        headers: {
            "Authorization": "Bearer " + jwtToken
        }
    })
    .then(response => {
        if (!response.ok) throw new Error("Nepoda≈ôilo se naƒç√≠st tip");
        return response.json();
    })
    .then(recipe => {
        tipDiv.innerHTML = `
            <div class="recipe-content">
                <div class="recipe-left">
                    <div class="recipe-title">${recipe.title}</div>
                    <em class="category">${recipe.category}</em><br>

                    <div class="recipe-right">
                    ${recipe.imagePath ? `<img class="recipe-image" src="${API_BASE}/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                </div>

                    <div class="recipe-section-title">Ingredience:</div>
                    <div class="recipe-ingredients">
                        ${recipe.ingredients
                            .split(',')
                            .map(i => '‚Ä¢ ' + i.trim())
                            .join('<br>')}
                    </div>

                    <div class="recipe-section-title">Postup:</div>
                    <div class="recipe-instructions">
                        ${recipe.instructions
                            .split('\n')
                            .map(line => line.trimStart()) // odstran√≠ mezery/taby na zaƒç√°tku ≈ô√°dku
                            .join('\n')}
                    </div>

                </div>


            </div>
        `;
        tipSection.classList.remove("hidden");
    })
    .catch(error => {
        console.warn("Chyba p≈ôi naƒç√≠t√°n√≠ tipu:", error);
        tipDiv.innerHTML = "Tip se nepoda≈ôilo naƒç√≠st.";
        tipSection.classList.remove("hidden");
    });
}

   function showHome() {
      // Ve≈ôejn√° ƒç√°st vidƒõt
      authSection.classList.add("hidden");
      document.getElementById("publicRecipes").classList.remove("hidden");


      adminPanel.classList.add("hidden");
      adminRecipesSection.classList.add("hidden");
      adminUsersSection.classList.add("hidden");
      recipeForm.classList.add("hidden");
      // zru≈° "active" na admin z√°lo≈æk√°ch
      if (typeof adminRecipesTab !== "undefined") adminRecipesTab.classList.remove("active");
      if (typeof adminUsersTab !== "undefined") adminUsersTab.classList.remove("active");


      // Karty kategori√≠ + ƒçist√Ω list
      renderCategories();
      publicRecipeList.innerHTML = "";

      // TIP je na domovsk√© obrazovce v≈ædy vidƒõt
      const tipSection = document.getElementById("dailyTip");
      tipSection.classList.remove("hidden");
      loadDailyTip();
    }

    function showAdminHome() {
          // schovat ve≈ôejnou ƒç√°st
          authSection.classList.add("hidden");
          document.getElementById("publicRecipes").classList.add("hidden");
          const tip = document.getElementById("dailyTip");
          if (tip) tip.classList.add("hidden");

          // zobrazit admin panel
          adminPanel.classList.remove("hidden");

          // p≈ôepnout z√°lo≈æky na Recepty
          adminRecipesTab.classList.add("active");
          adminUsersTab.classList.remove("active");
          adminRecipesSection.classList.remove("hidden");
          adminUsersSection.classList.add("hidden");

          // kategorie + formul√°≈ô
          renderAdminCategories();
          recipeForm.classList.remove("hidden");

          // VYƒåISTIT seznamy a stav filtru, a≈• je to skuteƒçnƒõ "dom≈Ø"
          const adminRecipeList = document.getElementById("adminRecipeList");
          const publicList = document.getElementById("recipeList");
          if (adminRecipeList) adminRecipeList.innerHTML = "";
          if (publicList) publicList.innerHTML = "";
          editingId = null;

          // reset formul√°≈ôe (vƒçetnƒõ n√°zvu vybran√©ho souboru)
          const formEl = document.getElementById("recipeForm");
          if (formEl) formEl.reset();
          const fileNameDisplay = document.getElementById("fileNameDisplay");
          if (fileNameDisplay) fileNameDisplay.textContent = "≈Ω√°dn√Ω obr√°zek nevybr√°n";

          // zav≈ô√≠t p≈ô√≠padn√© modaly/overlaye a posunout nahoru k formul√°≈ôi
          const imageModal = document.getElementById("imageModal");
          const imagePopup = document.getElementById("imagePopup");
          if (imageModal) imageModal.classList.add("hidden");
          if (imagePopup) imagePopup.classList.add("hidden");
          // recipeForm.scrollIntoView({ behavior: "smooth", block: "start" });
            requestAnimationFrame(() => {
              window.scrollTo({ top: 0, left: 0, behavior: "auto" });
            });

        }


    function loadRecipes() {
        fetch(`${API_BASE}/recepty`, {
            headers: { "Authorization": "Bearer " + jwtToken }
        })
        .then(res => {
            if (!res.ok) {
                if (res.status === 401 || res.status === 403) {
                    throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                } else {
                    throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ recept≈Ø.");
                }
            }
            return res.json();
        })
        .then(data => {
            recipeList.innerHTML = "";
            data.forEach(recipe => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <div class="recipe-content">
                        <div class="recipe-left">
                            <strong>${recipe.title}</strong><br>
                            <em class="category">${recipe.category}</em><br>

                            <!-- üÜï ingredience obalen√© do recipe-ingredients -->
                            <div class="recipe-ingredients">
                                ${recipe.ingredients
                                    .split(',')
                                    .map(i => '‚Ä¢ ' + i.trim())
                                    .join('<br>')}
                            </div>
                        </div>
                        <div class="recipe-right">
                            ${recipe.imagePath ? `<img class="recipe-image" src="${API_BASE}/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                        </div>
                    </div>

                    <!-- üÜï instrukce se class recipe-instructions (CSS: white-space: pre-wrap) -->
                    <p class="recipe-instructions">${recipe.instructions}</p>

                    <div class="recipe-buttons">
                        <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è Upravit</button>
                        <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è Smazat</button>
                    </div>
                `;
                recipeList.appendChild(li);
            });
        })
        .catch(err => {
            authError.textContent = err.message;
            if (err.message.includes("odhl√°≈°en")) {
                logoutBtn.click();
            }
        });
    }

    function renderCategories() {
            categoriesList.innerHTML = "";

            const categoryData = [
            {
                name: "Pol√©vky",
                svg: `
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 10h18"/>
            <path d="M5 10v2a7 7 0 0 0 14 0v-2"/>
            <path d="M9 4c.5 1 .5 2 0 3"/>
            <path d="M15 4c.5 1 .5 2 0 3"/>
            </svg>`
            },
            {
                name: "Hlavn√≠ j√≠dla",
                svg: `
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="9"/>
            <circle cx="12" cy="12" r="4"/>
            <path d="M4 3v18"/>
            <path d="M20 3v18"/>
            </svg>`
            },
            {
            name: "Dezerty",
            svg: `
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <!-- Horn√≠ zaoblen√° ƒç√°st muffinu -->
            <path d="M6 10a4 4 0 0 1 12 0" fill="none"/>

            <!-- Spodn√≠ ƒç√°st muffinu -->
            <path d="M7 10l1 7h8l1-7z" fill="none"/>

            <!-- R√Ωhy v ko≈°√≠ƒçku -->
            <path d="M9 10v7" />
            <path d="M12 10v7" />
            <path d="M15 10v7" />

            <!-- T≈ôe≈°niƒçka na vrcholu -->
            <circle cx="12" cy="5" r="1"/>
            </svg>`
            }
            ,
            {
            name: "Sn√≠danƒõ",
            svg: `
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <!-- Toast -->
            <rect x="4" y="5" width="16" height="14" rx="3" ry="3"/>

            <!-- Vejce (b√≠lek) -->
            <circle cx="12" cy="12" r="4" />

            <!-- ≈Ωloutek -->
            <circle cx="12" cy="12" r="1.5" fill="#f4f1e6" />
            </svg>`
            }
            ,
            {
            name: "Svaƒçiny",
            svg: `
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <!-- Troj√∫heln√≠k jako sendviƒç -->
            <path d="M4 6l16 12H4z" />

            <!-- N√°pl≈à -->
            <path d="M6 10l5 4" />
            <path d="M8 8l8 6" />
            </svg>`
            }

            ];




            categoryData.forEach(cat => {
                const card = document.createElement("div");
                card.classList.add("category-card");

                const icon = document.createElement("div");
                icon.classList.add("category-icon");
                icon.innerHTML = cat.svg;


                const label = document.createElement("span");
                label.textContent = cat.name;

                card.appendChild(icon);
                card.appendChild(label);

                card.addEventListener("click", () => loadPublicRecipes(cat.name));
                categoriesList.appendChild(card);
            });
        }

    function loadUsers() {
            fetch(`${API_BASE}/admin/users`, {
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                    } else {
                        throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø.");
                    }
                }
                return res.json();
            })
            .then(users => {
                console.log("U≈æivatel√© z backendu:", users);
                if (adminUsersTab.classList.contains("active")) {
                    adminUsersSection.classList.remove("hidden");
                } else {
                    adminUsersSection.classList.add("hidden");
                }

                usersTableBody.innerHTML = "";

                if (users.length === 0) {
                    usersTableBody.innerHTML = `<tr><td colspan="5">≈Ω√°dn√≠ u≈æivatel√© k zobrazen√≠.</td></tr>`;
                    return;
                }

                users.forEach(user => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>
                        <select data-user-id="${user.id}" class="role-select">
                            <option value="ROLE_USER" ${user.role === "ROLE_USER" ? "selected" : ""}>USER</option>
                            <option value="ROLE_ADMIN" ${user.role === "ROLE_ADMIN" ? "selected" : ""}>ADMIN</option>
                        </select>
                        </td>
                        <td>
                        <button class="delete-user-btn" data-user-id="${user.id}">üóëÔ∏è Smazat</button>
                        </td>
                    `;
                    usersTableBody.appendChild(tr);
                });




                // P≈ôid√°me event listener pro zmƒõnu role
                usersTableBody.querySelectorAll(".role-select").forEach(select => {
                    select.addEventListener("change", e => {
                        const id = e.target.getAttribute("data-user-id");
                        const newRole = e.target.value;
                        changeUserRole(id, newRole);
                    });
                });

                // P≈ôid√°me event listener pro maz√°n√≠ u≈æivatele
                usersTableBody.querySelectorAll(".delete-user-btn").forEach(btn => {
                    btn.addEventListener("click", e => {
                        const id = e.target.getAttribute("data-user-id");
                        if (confirm("Opravdu chcete smazat tohoto u≈æivatele?")) {
                            deleteUser(id);
                        }
                    });
                });
            })
            .catch(err => {
                alert(err.message);
                if (err.message.includes("odhl√°≈°en")) logoutBtn.click();
            });
        }

    function changeUserRole(id, role) {
            fetch(`${API_BASE}/admin/users/${id}/role?role=${role}`, {
                method: "PUT",
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                if (!res.ok) throw new Error("Chyba p≈ôi zmƒõnƒõ role u≈æivatele.");
                alert("Role u≈æivatele byla zmƒõnƒõna.");
                loadUsers();
            })
            .catch(err => {
                alert(err.message);
                loadUsers(); // obnov√≠me seznam kv≈Øli konzistenci
            });
        }

        function deleteUser(id) {
            fetch(`${API_BASE}/admin/users/${id}`, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + jwtToken }
            })
            .then(res => {
                console.log("Stav maz√°n√≠ u≈æivatele:", res.status);

                if (res.status === 401 || res.status === 403) {
                    throw new Error("Byl jsi odhl√°≈°en. P≈ôihlas se znovu.");
                }

                if (!res.ok) {
                return res.text().then(text => {
                    console.warn("Chyba p≈ôi maz√°n√≠ u≈æivatele:", text);
                    throw new Error("Chyba p≈ôi maz√°n√≠ u≈æivatele: " + text);
                });
            }


                alert("U≈æivatel byl smaz√°n.");
                loadUsers();
            })
            .catch(err => {
                console.log("Chyba p≈ôi maz√°n√≠:", err);
                alert(err.message);

                if (err.message.includes("odhl√°≈°en")) {
                    console.warn("Vyvol√°v√°m logout kv≈Øli chybƒõ:", err.message);
                    logoutBtn.click();
                }
            });

        }

    function renderAdminCategories() {

            const categories = ["Pol√©vky", "Hlavn√≠ j√≠dla", "Dezerty", "Sn√≠danƒõ", "Svaƒçiny"];
            const categoryData = [
                {
                    name: "Pol√©vky",
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                        viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                        stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 10h18"/>
                        <path d="M5 10v2a7 7 0 0 0 14 0v-2"/>
                        <path d="M9 4c.5 1 .5 2 0 3"/>
                        <path d="M15 4c.5 1 .5 2 0 3"/>
                    </svg>`
                },
                {
                    name: "Hlavn√≠ j√≠dla",
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                        viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                        stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="9"/>
                        <circle cx="12" cy="12" r="4"/>
                        <path d="M4 3v18"/>
                        <path d="M20 3v18"/>
                    </svg>`
                },
                {
                    name: "Dezerty",
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                        viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 10a4 4 0 0 1 12 0"/>
                        <path d="M7 10l1 7h8l1-7z"/>
                        <path d="M9 10v7"/>
                        <path d="M12 10v7"/>
                        <path d="M15 10v7"/>
                        <circle cx="12" cy="5" r="1"/>
                    </svg>`
                },
                {
                    name: "Sn√≠danƒõ",
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                        viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="4" y="5" width="16" height="14" rx="3" ry="3"/>
                        <circle cx="12" cy="12" r="4" />
                        <circle cx="12" cy="12" r="1.5" fill="#f4f1e6" />
                    </svg>`
                },
                {
                    name: "Svaƒçiny",
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                        viewBox="0 0 24 24" fill="none" stroke="#f4f1e6"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 6l16 12H4z" />
                        <path d="M6 10l5 4" />
                        <path d="M8 8l8 6" />
                    </svg>`
                }
            ];

            const adminCategoriesList = document.getElementById("adminCategoriesList");
            adminCategoriesList.innerHTML = "";

            categoryData.forEach(cat => {
                const card = document.createElement("div");
                card.classList.add("category-card");

                const icon = document.createElement("div");
                icon.classList.add("category-icon");
                icon.innerHTML = cat.svg;

                const label = document.createElement("span");
                label.textContent = cat.name;

                card.appendChild(icon);
                card.appendChild(label);

                card.addEventListener("click", () => loadAdminRecipesByCategory(cat.name));
                adminCategoriesList.appendChild(card);
            });
        }

        function loadAdminRecipesByCategory(category) {
          // UI p≈ôepnut√≠ do admin Recept≈Ø
          adminRecipesTab.classList.add("active");
          adminUsersTab.classList.remove("active");
          adminRecipesSection.classList.remove("hidden");
          adminUsersSection.classList.add("hidden");
          recipeForm.classList.remove("hidden");

          // schovat ve≈ôejnou ƒç√°st (d≈Øle≈æit√©)
          document.getElementById("publicRecipes").classList.add("hidden");
          document.getElementById("dailyTip")?.classList.add("hidden");

          // PRACUJEME JEN S adminRecipeList (≈æ√°dn√Ω recipeList/publicRecipeList)
          const adminRecipeList = document.getElementById("adminRecipeList");
          adminRecipeList.innerHTML = "";

          fetch(`${API_BASE}/recepty?category=` + encodeURIComponent(category), {
            headers: { "Authorization": "Bearer " + jwtToken }
          })
          .then(res => {
            if (!res.ok) throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ recept≈Ø.");
            return res.json();
          })
          .then(data => {
            if (!Array.isArray(data) || data.length === 0) {
              adminRecipeList.innerHTML = "<li>≈Ω√°dn√© recepty v t√©to kategorii.</li>";
              return;
            }

            data.forEach(recipe => {
              const li = document.createElement("li");
              li.innerHTML = `
                <div class="recipe-content">
                  <div class="recipe-left">
                    <strong>${recipe.title}</strong><br>
                    <em class="category">${recipe.category}</em>
                    <div class="recipe-ingredients">
                      ${recipe.ingredients.split(',').map(i => '‚Ä¢ ' + i.trim()).join('<br>')}
                    </div>
                  </div>
                  <div class="recipe-right">
                    ${recipe.imagePath ? `<img class="recipe-image" src="${API_BASE}/pictures/${recipe.imagePath}" alt="Obr√°zek receptu">` : ""}
                  </div>
                </div>
                <p class="recipe-instructions">${recipe.instructions}</p>
                <div class="recipe-buttons">
                  <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è Upravit</button>
                  <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è Smazat</button>
                </div>
              `;
              adminRecipeList.appendChild(li);
            });
          })
          .catch(err => {
            adminRecipeList.innerHTML = `<li>Chyba: ${err.message}</li>`;
          });
        }


    window.editRecipe = function (id) {
          editingId = id;

          // ‚¨á‚¨á‚¨á P≈òIDEJ TOTO ‚Äì p≈ôepnout UI do re≈æimu ADMIN/RECEPTY a schovat ve≈ôejnou ƒç√°st + TIP ‚¨á‚¨á‚¨á
          document.getElementById("publicRecipes").classList.add("hidden");
          document.getElementById("dailyTip").classList.add("hidden");
          adminPanel.classList.remove("hidden");

          adminRecipesTab.classList.add("active");
          adminUsersTab.classList.remove("active");

          adminRecipesSection.classList.remove("hidden");
          adminUsersSection.classList.add("hidden");

          // zobrazit formul√°≈ô pro editaci
          recipeForm.classList.remove("hidden");

          // reset stavu file inputu / popisku
          const fileNameDisplay = document.getElementById("fileNameDisplay");
          if (fileNameDisplay) fileNameDisplay.textContent = "≈Ω√°dn√Ω obr√°zek nevybr√°n";
          const imageInput = document.getElementById("imageInput");
          if (imageInput) imageInput.value = "";
          // ‚¨Ü‚¨Ü‚¨Ü P≈òIDEJ TOTO ‚¨Ü‚¨Ü‚¨Ü

          fetch(`${API_BASE}/recepty/${id}`, {
            method: "GET",
            headers: { "Authorization": "Bearer " + jwtToken }
          })
            .then(response => {
              if (!response.ok) throw new Error("Nepoda≈ôilo se naƒç√≠st recept.");
              return response.json();
            })
            .then(recipe => {
              document.getElementById("title").value = recipe.title;
              document.getElementById("category").value = recipe.category;
              document.getElementById("ingredients").value = recipe.ingredients;
              document.getElementById("instructions").value = recipe.instructions;

              // volitelnƒõ posu≈à formul√°≈ô do zorn√©ho pole
              recipeForm.scrollIntoView({ behavior: "smooth", block: "start" });
            })
            .catch(err => {
              alert("Chyba p≈ôi naƒç√≠t√°n√≠ receptu: " + err.message);
            });
        };


    window.submitEditRecipe = function () {
          const id = editingId;
          if (!id) {
            alert("Chyb√≠ ID receptu k √∫pravƒõ.");
            return;
          }

          const title = document.getElementById("title").value;
          const category = document.getElementById("category").value;
          const ingredients = document.getElementById("ingredients").value;
          const instructions = document.getElementById("instructions").value;
          const imageInput = document.getElementById("imageInput");

          const formData = new FormData();
          formData.append("title", title);
          formData.append("category", category);
          formData.append("ingredients", ingredients);
          formData.append("instructions", instructions);
          if (imageInput.files.length > 0) {
            formData.append("image", imageInput.files[0]); // nov√Ω obr√°zek
          }

          fetch(`${API_BASE}/recepty/${id}`, {
            method: "PUT",
            headers: { "Authorization": "Bearer " + jwtToken },
            body: formData
          })
            .then(response => {
              if (!response.ok) throw new Error("Nepoda≈ôilo se upravit recept.");
              return response.json();
            })
            .then(data => {
              alert("Recept upraven.");

              // zpƒõt na admin domov s formul√°≈ôem
              editingId = null;
              showAdminHome();

              // vyƒçistit formul√°≈ô i stav souboru
              recipeForm.reset();
              const imageInput = document.getElementById("imageInput");
              if (imageInput) imageInput.value = "";
              const fileNameDisplay = document.getElementById("fileNameDisplay");
              if (fileNameDisplay) fileNameDisplay.textContent = "≈Ω√°dn√Ω obr√°zek nevybr√°n";

              // p≈ôepnout tlaƒç√≠tko na "P≈ôidat recept"
              const submitBtn = recipeForm.querySelector('button[type="submit"]');
              if (submitBtn) submitBtn.textContent = "P≈ôidat recept";

              // pr√°zdn√Ω seznam (nic neukazovat, dokud neklikne≈° kategorii)
              const adminRecipeList = document.getElementById("adminRecipeList");
              if (adminRecipeList) adminRecipeList.innerHTML = "";
            })

            .catch(error => {
              alert("Chyba p≈ôi √∫pravƒõ receptu: " + error.message);
            });
        };


   window.createRecipe = function () {
          const title = document.getElementById("title").value;
          const category = document.getElementById("category").value;
          const ingredients = document.getElementById("ingredients").value;
          const instructions = document.getElementById("instructions").value;
          const imageInput = document.getElementById("imageInput");

          const formData = new FormData();
          formData.append("title", title);
          formData.append("category", category);
          formData.append("ingredients", ingredients);
          formData.append("instructions", instructions);

          if (imageInput.files.length > 0) {
            formData.append("image", imageInput.files[0]);
          }

          fetch(`${API_BASE}/recepty`, {
            method: "POST",
            headers: {
              "Authorization": "Bearer " + jwtToken
            },
            body: formData
          })
            .then(response => {
              if (!response.ok) throw new Error("Chyba p≈ôi vytv√°≈ôen√≠ receptu.");
              return response.json();
            })
            .then(data => {
                  alert("Recept vytvo≈ôen.");

                  // p≈ôepnout na admin domov (z√°lo≈æky, kategorie, FORM)
                  editingId = null;
                  showAdminHome();

                  // vyƒçistit formul√°≈ô i stav souboru
                  recipeForm.reset();
                  const imageInput = document.getElementById("imageInput");
                  if (imageInput) imageInput.value = "";
                  const fileNameDisplay = document.getElementById("fileNameDisplay");
                  if (fileNameDisplay) fileNameDisplay.textContent = "≈Ω√°dn√Ω obr√°zek nevybr√°n";

                  // vr√°tit text tlaƒç√≠tka do re≈æimu "P≈ôidat recept"
                  const submitBtn = recipeForm.querySelector('button[type="submit"]');
                  if (submitBtn) submitBtn.textContent = "P≈ôidat recept";

                  // nechat seznam pr√°zdn√Ω (naƒçte se a≈æ po kliknut√≠ na kategorii)
                  const adminRecipeList = document.getElementById("adminRecipeList");
                  if (adminRecipeList) adminRecipeList.innerHTML = "";
                })

            .catch(error => {
              alert("Chyba: " + error.message);
            });
        };

    window.deleteRecipe = function (id) {
          if (!confirm("Opravdu chcete smazat tento recept?")) return;

          fetch(`${API_BASE}/recepty/${id}`, {
            method: "DELETE",
            headers: {
              "Authorization": "Bearer " + jwtToken
            }
          })
            .then(response => {
              if (!response.ok) throw new Error("Chyba p≈ôi maz√°n√≠ receptu.");
              // √∫spƒõ≈°nƒõ smaz√°no
              alert("Recept smaz√°n.");
              document.getElementById("adminRecipeList").innerHTML = ""; // sma≈æeme v√Ωpis
            })
            .catch(error => {
              alert("Chyba: " + error.message);
            });
        };

    window.setupImageModal = function () {
          const modal = document.getElementById("imageModal");
          const modalImg = document.getElementById("modalImage");
          const closeModal = document.querySelector(".close-modal");

          document.addEventListener("click", function (e) {
            if (e.target.classList.contains("recipe-image")) {
              modal.classList.remove("hidden");
              modalImg.src = e.target.src;
            }

            if (e.target.classList.contains("close-modal") || e.target === modal) {
              modal.classList.add("hidden");
              modalImg.src = "";
            }
          });
        };

    window.setupImagePopup = function () {
      const popup = document.getElementById("imageModal");
      const popupImg = document.getElementById("popupImage");
      const closeBtn = document.querySelector(".close-popup");

      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("recipe-image")) {
          popup.classList.remove("hidden");
          popupImg.src = e.target.src;
        }

        if (e.target.classList.contains("close-popup") || e.target === popup) {
          popup.classList.add("hidden");
          popupImg.src = "";
        }
      });
    };

   function closeOverlays() {
      document.querySelectorAll('.image-modal, .image-popup').forEach(el => el.classList.add('hidden'));
        }

        document.addEventListener("click", (e) => {
          const logo = e.target.closest("#homeTitle");
          if (!logo) return;

          closeOverlays(); // ‚Üê p≈ôidat

          if (!jwtToken || !userRole) {
            authSection.classList.remove("hidden");
            adminPanel.classList.add("hidden");
            document.getElementById("publicRecipes").classList.add("hidden");
            return;
          }
          if (userRole === "ROLE_ADMIN") showAdminHome(); else showHome();
        });


    // === DOMCONTENTLOADED ===
document.addEventListener("DOMContentLoaded", () => {

  const adminBtn = document.getElementById("adminBtn");
  const loginSection = document.getElementById("authSection");
  const adminPanel = document.getElementById("adminPanel");
  const loginForm = document.getElementById("loginForm");
  const authError = document.getElementById("authError");
  const recipeList = document.getElementById("recipeList");
  const recipeForm = document.getElementById("recipeForm");
  const loginTab = document.getElementById("loginTab");
  const registerTab = document.getElementById("registerTab");
  const loginFormEl = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");
  const usernameDisplay = document.getElementById("usernameDisplay");
  const logoutBtn = document.getElementById("logoutBtn");

  const imageInput = document.getElementById("imageInput");
  const fileNameDisplay = document.getElementById("fileNameDisplay");

      // --- Zapomenut√© heslo (toggle + odesl√°n√≠) ---
    const forgotLink = document.getElementById("forgotLink");
    const forgotSection = document.getElementById("forgotSection");
    const forgotSubmit = document.getElementById("forgotSubmit");
    const forgotEmail = document.getElementById("forgotEmail");
    const forgotMsg = document.getElementById("forgotMsg");

    if (forgotLink) {
      forgotLink.addEventListener("click", (e) => {
        e.preventDefault();
        forgotSection.classList.toggle("hidden");
      });
    }

    if (forgotSubmit) {
      forgotSubmit.addEventListener("click", () => {
        const email = (forgotEmail.value || "").trim();
        if (!email) return;
        fetch(`${API_BASE}/auth/forgot`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ email })
        }).then(() => {
          forgotMsg.textContent = "Pokud e-mail existuje, poslali jsme odkaz pro reset.";
        }).catch(() => {
          forgotMsg.textContent = "Pokud e-mail existuje, poslali jsme odkaz pro reset.";
        });
      });
    }

    // --- Zpracov√°n√≠ token≈Ø z URL (?verifyToken=..., ?resetToken=...) ---
    const params = new URLSearchParams(location.search);
    const verifyToken = params.get("verifyToken");
    const resetToken = params.get("resetToken");

    // Potvrzen√≠ √∫ƒçtu
    if (verifyToken) {
      fetch(`${API_BASE}/auth/confirm?token=${encodeURIComponent(verifyToken)}`)
        .then(r => r.ok ? r.text() : Promise.reject())
        .then(() => {
          alert("E-mail potvrzen. M≈Ø≈æe≈° se p≈ôihl√°sit.");
          history.replaceState({}, "", location.pathname);
        })
        .catch(() => {
          alert("Potvrzen√≠ se nepoda≈ôilo. Zkus to znovu nebo po≈æ√°dej o nov√Ω odkaz.");
          history.replaceState({}, "", location.pathname);
        });
    }

    // Reset hesla ‚Äì minimalisticky p≈ôes prompt (m≈Ø≈æe≈° nahradit vlastn√≠m UI)
    if (resetToken) {
      const newPass = prompt("Zadej nov√© heslo:");
      if (newPass && newPass.length >= 6) {
        fetch(`${API_BASE}/auth/reset`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ token: resetToken, newPassword: newPass })
        }).then(r => {
          if (r.ok) alert("Heslo zmƒõnƒõno, m≈Ø≈æe≈° se p≈ôihl√°sit.");
          else alert("Reset se nepoda≈ôil.");
          history.replaceState({}, "", location.pathname);
        }).catch(() => {
          alert("Reset se nepoda≈ôil.");
          history.replaceState({}, "", location.pathname);
        });
      } else {
        history.replaceState({}, "", location.pathname);
      }
    }


  imageInput.addEventListener("change", () => {
    fileNameDisplay.textContent = imageInput.files.length > 0
      ? `Vybran√Ω obr√°zek: ${imageInput.files[0].name}`
      : "≈Ω√°dn√Ω obr√°zek nevybr√°n";
  });

  const adminRecipesTab = document.getElementById("adminRecipesTab");
  const adminUsersTab = document.getElementById("adminUsersTab");
  const adminRecipesSection = document.getElementById("adminRecipesSection");
  const adminUsersSection = document.getElementById("adminUsersSection");
  usersTableBody = document.querySelector("#usersTable tbody");


  // p≈ôep√≠n√°n√≠ z√°lo≈æek
  adminRecipesTab.addEventListener("click", () => {
      // re≈æim: ADMIN
      document.getElementById("publicRecipes").classList.add("hidden");   // skryj ve≈ôejnou ƒç√°st
      document.getElementById("dailyTip").classList.add("hidden");        // skryj TIP
      adminPanel.classList.remove("hidden");                               // uka≈æ admin panel

      // z√°lo≈æky
      adminRecipesTab.classList.add("active");
      adminUsersTab.classList.remove("active");

      // sekce
      adminRecipesSection.classList.remove("hidden");
      adminUsersSection.classList.add("hidden");

      // formul√°≈ô nech skryt√Ω (zobraz√≠ se a≈æ p≈ôi editaci / p≈ôid√°n√≠)
      recipeForm.classList.add("hidden");

      // vyƒçi≈°tƒõn√≠ ve≈ôejn√©ho seznamu (volitelnƒõ)
      publicRecipeList.innerHTML = "";

      // naƒçti admin recepty (pou≈æij tu funkci, kterou m√°≈°)
      loadRecipes(); // nebo loadAdminRecipes()
    });


  adminUsersTab.addEventListener("click", () => {
      // re≈æim: ADMIN
      document.getElementById("publicRecipes").classList.add("hidden");
      document.getElementById("dailyTip").classList.add("hidden");
      adminPanel.classList.remove("hidden");

      // z√°lo≈æky
      adminUsersTab.classList.add("active");
      adminRecipesTab.classList.remove("active");

      // sekce
      adminUsersSection.classList.remove("hidden");
      adminRecipesSection.classList.add("hidden");

      // formul√°≈ô skryt√Ω
      recipeForm.classList.add("hidden");

      // vyƒçi≈°tƒõn√≠ seznam≈Ø
      document.getElementById("recipeList").innerHTML = "";
      document.getElementById("adminRecipeList").innerHTML = "";
      publicRecipeList.innerHTML = "";

      // naƒç√≠st u≈æivatele
      loadUsers();
    });


  // vykreslen√≠ kategori√≠
  renderCategories();

  // pokud u≈æ je token v localStorage, rovnou p≈ôihl√°s√≠me
  if (jwtToken && currentUsername) {
  usernameDisplay.textContent = currentUsername;
  usernameDisplay.classList.remove("hidden");
  logoutBtn.classList.remove("hidden");
  loginSection.classList.add("hidden");

  if (userRole === "ROLE_ADMIN") {
    showAdminHome();
  } else {
    showHome();
  }
}


  // p≈ôep√≠n√°n√≠ login/register tab≈Ø
  loginTab.addEventListener("click", () => {
    loginTab.classList.add("active");
    registerTab.classList.remove("active");
    loginFormEl.classList.remove("hidden");
    registerForm.classList.add("hidden");
    authError.textContent = "";
  });

  registerTab.addEventListener("click", () => {
    registerTab.classList.add("active");
    loginTab.classList.remove("active");
    registerForm.classList.remove("hidden");
    loginFormEl.classList.add("hidden");
    authError.textContent = "";
  });

  // p≈ôihl√°≈°en√≠
  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;

    fetch(`${API_BASE}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    })
      .then(res => {
        if (!res.ok) throw new Error("Neplatn√© p≈ôihla≈°ovac√≠ √∫daje");
        return res.json();
      })
      .then(data => {
        jwtToken = data.token;
        userRole = data.role;
        currentUsername = username;

        localStorage.setItem("jwtToken", jwtToken);
        localStorage.setItem("currentUsername", currentUsername);
        localStorage.setItem("userRole", userRole);

        authError.textContent = "";
        loginSection.classList.add("hidden");
        usernameDisplay.textContent = username;
        usernameDisplay.classList.remove("hidden");
        logoutBtn.classList.remove("hidden");


        if (data.role === "ROLE_ADMIN") {
          showAdminHome();

        } else {
          showHome();
        }
      })
      .catch(err => {
        authError.textContent = err.message || "Chyba p≈ôi p≈ôihl√°≈°en√≠";
      });
  });

  // registrace
  registerForm.addEventListener("submit", e => {
    e.preventDefault();
    const username = document.getElementById("registerUsername").value;
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;

    fetch(`${API_BASE}/auth/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password }),
    })
      .then(res => {
        if (!res.ok) throw new Error("Chyba p≈ôi registraci u≈æivatele");
        return res.text();
      })
      .then(() => {
        authError.textContent = "Registrace probƒõhla √∫spƒõ≈°nƒõ, pros√≠m p≈ôihlaste se.";
        registerTab.classList.remove("active");
        loginTab.classList.add("active");
        registerForm.classList.add("hidden");
        loginFormEl.classList.remove("hidden");
        registerForm.reset();
      })
      .catch(err => {
        authError.textContent = err.message || "Chyba p≈ôi registraci.";
      });
  });

  // odhl√°≈°en√≠
  logoutBtn.addEventListener("click", () => {
    jwtToken = null;
    editingId = null;
    currentUsername = null;

    localStorage.removeItem("jwtToken");
    localStorage.removeItem("currentUsername");
    localStorage.removeItem("userRole");

    usernameDisplay.textContent = "";
    usernameDisplay.classList.add("hidden");
    logoutBtn.classList.add("hidden");
    loginSection.classList.remove("hidden");
    adminPanel.classList.add("hidden");
    document.getElementById("publicRecipes").classList.add("hidden");
    authError.textContent = "";
  });


  // recepty po odesl√°n√≠ formul√°≈ôe
  recipeForm.addEventListener("submit", function (e) {
    e.preventDefault();
    if (editingId) {
      submitEditRecipe();
    } else {
      createRecipe(); // nebo pou≈æij p≈ô√≠mo stejn√Ω k√≥d zde
    }
  });

  setupImageModal();
  setupImagePopup();

});


      </script>
</body>
</html>
